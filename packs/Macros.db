{"name":"Basic Roll","type":"script","scope":"global","author":"0uQsagcnnkt56LRN","img":"icons/svg/dice-target.svg","command":"// This macro just prompts the user to roll a dice, and they can add additional dice if they need to.\n\n// Define the actor\nconst actor = game.actors.get(ChatMessage.getSpeaker().actor)\nconst data = actor.system\n\n// Send the roll to the API\nWOD5E.api.Roll({\n   title: \"Rolling...\",\n   basicDice: 1,\n   disableAdvancedDice: true\n})","folder":null,"ownership":{"default":0,"OrOQ70SVPCGayvrw":3,"0uQsagcnnkt56LRN":3},"flags":{"core":{}},"_stats":{"systemId":"vtm5e","systemVersion":"4.1.1","coreVersion":"13.341","createdTime":1707614396503,"modifiedTime":1712928203350,"lastModifiedBy":"0uQsagcnnkt56LRN","compendiumSource":null,"duplicateSource":null,"exportSource":null},"_id":"RTbzoDnCvi7Y7oAe","sort":0}
{"name":"Adjust Rage","type":"script","scope":"global","author":"OrOQ70SVPCGayvrw","img":"systems/wod5e/assets/icons/dice/werewolf/success.png","command":"// Grab the list of selected tokens and map them\nconst tokens = canvas.tokens.controlled\nconst actorsList = tokens.map((i) => i.actor)\n\n// Build the options for the select dropdown\nconst content = new foundry.data.fields.NumberField({\n  label: game.i18n.localize('WOD5E.Compendiums.Macros.AdjustRageBy'),\n  required: true,\n  nullable: false,\n  initial: 0,\n  min: -5,\n  max: 5\n}).toFormGroup(\n  {},\n  {\n    name: 'mod'\n  }\n).outerHTML\n\n// Prompt a dialog to determine which edge we're adding\nconst rageModifier = await foundry.applications.api.DialogV2.prompt({\n  window: {\n    title: game.i18n.localize('WOD5E.Compendiums.Macros.AdjustRage')\n  },\n  classes: ['wod5e', 'macro', 'dialog', 'werewolf', 'dialog'],\n  content,\n  ok: {\n    callback: (event, button) =>\n      new foundry.applications.ux.FormDataExtended(button.form).object.mod\n  },\n  modal: true\n})\n\nif (rageModifier) {\n  for (const actor of actorsList) {\n    // If the actor isn't a werewolf or doesn't have rage, skip them\n    if (actor.system.gamesystem !== 'werewolf' && actor.system?.rage) continue\n\n    // Grab the actor's current rage\n    const oldValue = Number(actor.system.rage.value)\n\n    // Add the rage modifier to the actor's old vlaue\n    let newValue = oldValue + rageModifier\n\n    // Check to make sure the input doesn't go over or below max/min values\n    if (newValue > 5) newValue = 5\n    if (newValue < 0) newValue = 0\n\n    actor.update({ 'system.rage.value': newValue })\n  }\n}","folder":null,"ownership":{"default":0,"OrOQ70SVPCGayvrw":3},"flags":{"core":{}},"_stats":{"systemId":"vtm5e","systemVersion":"4.0.0-prerelease2","coreVersion":"13.351","createdTime":1701128014450,"modifiedTime":1764431152561,"lastModifiedBy":"0uQsagcnnkt56LRN","compendiumSource":null,"duplicateSource":null,"exportSource":null},"_id":"msVZH2N9fH5emdEo","sort":0}
{"name":"Random Character Generator","type":"script","_id":"qn5XkZ4Ya2Uer3jn","author":"0uQsagcnnkt56LRN","img":"icons/svg/dice-target.svg","scope":"global","command":"/**\n * Random character generator by Nin (hagelbuchern) on the FoundryVTT Discord.\n */\n\nconst valuesToDistribute = [4, 3, 3, 3, 2, 2, 2, 2, 1]\n\nconst attributeKeys = [\n  'strength',\n  'dexterity',\n  'stamina',\n  'charisma',\n  'manipulation',\n  'composure',\n  'intelligence',\n  'wits',\n  'resolve'\n]\n\nconst skillKeys = [\n  'athletics',\n  'brawl',\n  'craft',\n  'drive',\n  'firearms',\n  'melee',\n  'larceny',\n  'stealth',\n  'survival',\n  'animalken',\n  'etiquette',\n  'insight',\n  'intimidation',\n  'leadership',\n  'performance',\n  'persuasion',\n  'streetwise',\n  'subterfuge',\n  'academics',\n  'awareness',\n  'finance',\n  'investigation',\n  'medicine',\n  'occult',\n  'politics',\n  'science',\n  'technology'\n]\n\nconst skillDistributions = {\n  specialist: {\n    label: game.i18n.localize(\n      'WOD5E.Compendiums.Macros.RandomCharacterGenerator.Dialog.Options.Specialist'\n    ),\n    values: [4, 3, 3, 3, 2, 2, 2, 1, 1, 1],\n    count: 10\n  },\n  balanced: {\n    label: game.i18n.localize(\n      'WOD5E.Compendiums.Macros.RandomCharacterGenerator.Dialog.Options.Balanced'\n    ),\n    values: [3, 3, 3, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1],\n    count: 15\n  },\n  jack: {\n    label: game.i18n.localize(\n      'WOD5E.Compendiums.Macros.RandomCharacterGenerator.Dialog.Options.JackOfAllTrades'\n    ),\n    values: [3, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],\n    count: 19\n  }\n}\n\nfunction shuffleArray(array) {\n  const shuffled = [...array]\n  for (let i = shuffled.length - 1; i > 0; i--) {\n    const j = Math.floor(Math.random() * (i + 1))\n    ;[shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]]\n  }\n  return shuffled\n}\n\nasync function createRandomCharacter() {\n  const result = await foundry.applications.api.DialogV2.prompt({\n    window: {\n      title: game.i18n.localize('WOD5E.Compendiums.Macros.RandomCharacterGenerator.Dialog.Title'),\n      icon: 'fas fa-user-plus'\n    },\n    position: {\n      width: 450\n    },\n    content: `\n            <form>\n                <div class=\"form-group\">\n                    <label>${game.i18n.localize('WOD5E.Name')}</label>\n                    <input type=\"text\" name=\"actorName\" value=\"${game.i18n.localize('WOD5E.Compendiums.Macros.RandomCharacterGenerator.Dialog.NewCharacter')}\" autofocus/>\n                </div>\n                <div class=\"form-group\">\n                    <label>${game.i18n.localize('WOD5E.ItemsList.Type')}</label>\n                    <select name=\"actorType\">\n                        <option value=\"mortal\">${game.i18n.localize('TYPES.Actor.mortal')}</option>\n                        <option value=\"vampire\">${game.i18n.localize('TYPES.Actor.vampire')}</option>\n                        <option value=\"ghoul\">${game.i18n.localize('TYPES.Actor.ghoul')}</option>\n                        <option value=\"werewolf\">${game.i18n.localize('TYPES.Actor.werewolf')}</option>\n                        <option value=\"hunter\">${game.i18n.localize('TYPES.Actor.hunter')}</option>\n                    </select>\n                </div>\n                <div class=\"form-group\">\n                    <label>${game.i18n.localize('WOD5E.Compendiums.Macros.RandomCharacterGenerator.Dialog.SkillDistribution')}</label>\n                    <select name=\"skillDistribution\">\n                        <option value=\"specialist\">${game.i18n.localize('WOD5E.Compendiums.Macros.RandomCharacterGenerator.Dialog.Options.Specialist')}</option>\n                        <option value=\"balanced\" selected>${game.i18n.localize('WOD5E.Compendiums.Macros.RandomCharacterGenerator.Dialog.Options.Balanced')}</option>\n                        <option value=\"jack\">${game.i18n.localize('WOD5E.Compendiums.Macros.RandomCharacterGenerator.Dialog.Options.JackOfAllTrades')}</option>\n                    </select>\n                </div>\n                <p style=\"font-style: italic; margin-top: 1em; font-size: 0.9em;\">\n                  ${game.i18n.localize('WOD5E.Compendiums.Macros.RandomCharacterGenerator.Dialog.AutoDistribute')}\n                </p>\n            </form>\n        `,\n    ok: {\n      label: 'Erstellen',\n      icon: 'fas fa-check',\n      callback: (event, button) => {\n        const formData = new FormData(button.form)\n        return {\n          actorName:\n            formData.get('actorName') ||\n            game.i18n.localize(\n              'WOD5E.Compendiums.Macros.RandomCharacterGenerator.Dialog.NewCharacter'\n            ),\n          actorType: formData.get('actorType') || 'vampire',\n          skillDistribution: formData.get('skillDistribution') || 'balanced'\n        }\n      }\n    },\n    cancel: {\n      label: 'Abbrechen',\n      icon: 'fas fa-times'\n    },\n    rejectClose: false,\n    modal: true\n  })\n\n  if (!result) return\n\n  const { actorName, actorType, skillDistribution } = result\n\n  // Create a new actor\n  const newActor = await Actor.create({\n    name: actorName,\n    type: actorType\n  })\n\n  if (!newActor) {\n    ui.notifications.error(\n      game.i18n.localize(\n        'WOD5E.Compendiums.Macros.RandomCharacterGenerator.Notifications.ErrorCreatingActor'\n      )\n    )\n    return\n  }\n\n  // Grab the data structure\n  const sys = newActor.system\n\n  // Check to make sure attributes and skills exist\n  if (!sys.attributes || !sys.skills) {\n    ui.notifications.warn(\n      game.i18n.localize(\n        'WOD5E.Compendiums.Macros.RandomCharacterGenerator.Notifications.PathNotFound'\n      )\n    )\n    console.log(\n      'World of Darkness 5e | ' +\n        game.i18n.localize(\n          'WOD5E.Compendiums.Macros.RandomCharacterGenerator.Dialog.Notifications.ActorSystemData'\n        ),\n      sys\n    )\n    console.log(\n      'World of Darkness 5e | ' +\n        game.i18n.localize(\n          'WOD5E.Compendiums.Macros.RandomCharacterGenerator.Notifications.AvailableProperties'\n        ),\n      Object.keys(sys)\n    )\n    return\n  }\n\n  // Attribute generation\n  const shuffledAttributes = shuffleArray(valuesToDistribute)\n  let updateData = {\n    system: {\n      attributes: {},\n      skills: {}\n    }\n  }\n\n  let chatContent = `<h3>${actorName}</h3>`\n  chatContent += `<p><strong>${game.i18n.localize('WOD5E.ItemsList.Type')}</strong> ${actorType} | <strong>${game.i18n.localize('WOD5E.Compendiums.Macros.RandomCharacterGenerator.Dialog.SkillDistribution')}</strong> ${skillDistributions[skillDistribution].label}</p>`\n  chatContent += `<h4>${game.i18n.localize('WOD5E.AttributesList.Label')}</h4><ul style=\"columns: 2;\">`\n\n  // Attribute generation\n  attributeKeys.forEach((key, index) => {\n    const val = shuffledAttributes[index]\n    updateData.system.attributes[key] = { value: val }\n\n    const label = key.charAt(0).toUpperCase() + key.slice(1)\n    chatContent += `<li><strong>${label}:</strong> ${val}</li>`\n  })\n  chatContent += `</ul>`\n\n  // Skill generation\n  const distribution = skillDistributions[skillDistribution]\n  const shuffledSkills = shuffleArray([...skillKeys])\n  const selectedSkills = shuffledSkills.slice(0, distribution.count)\n  const shuffledValues = shuffleArray([...distribution.values])\n\n  chatContent += `<h4>${game.i18n.localize('WOD5E.SkillsList.Label')}</h4><ul style=\"columns: 2;\">`\n  selectedSkills.forEach((key, index) => {\n    const val = shuffledValues[index]\n    updateData.system.skills[key] = { value: val }\n\n    const label = key.charAt(0).toUpperCase() + key.slice(1)\n    chatContent += `<li><strong>${label}:</strong> ${val}</li>`\n  })\n  chatContent += `</ul>`\n\n  // Health and Willpower calculation\n  const staminaValue = shuffledAttributes[attributeKeys.indexOf('stamina')]\n  const composureValue = shuffledAttributes[attributeKeys.indexOf('composure')]\n  const resolveValue = shuffledAttributes[attributeKeys.indexOf('resolve')]\n\n  const healthMax = staminaValue + 3\n  const willpowerMax = composureValue + resolveValue\n\n  // Update the actor's health and willpower\n  if (sys.health !== undefined) {\n    updateData.system.health = {\n      max: healthMax,\n      superficial: 0,\n      aggravated: 0,\n      value: healthMax\n    }\n  }\n\n  if (sys.willpower !== undefined) {\n    updateData.system.willpower = {\n      max: willpowerMax,\n      superficial: 0,\n      aggravated: 0,\n      value: willpowerMax\n    }\n  }\n\n  // Construct the chat message contents\n  chatContent += `<h4>${game.i18n.localize('WOD5E.Compendiums.Macros.RandomCharacterGenerator.Chat.DerivedValues')}</h4><ul>`\n  chatContent += `<li><strong>${game.i18n.localize('WOD5E.Health')}</strong> ${healthMax} (Stamina ${staminaValue} + 3)</li>`\n  chatContent += `<li><strong>${game.i18n.localize('WOD5E.Willpower')}</strong> ${willpowerMax} (Composure ${composureValue} + Resolve ${resolveValue})</li>`\n  chatContent += `</ul>`\n\n  // Update the actor\n  try {\n    await newActor.update(updateData)\n\n    // Send message in chat\n    await ChatMessage.create({\n      content: chatContent,\n      speaker: ChatMessage.getSpeaker({ actor: newActor })\n    })\n\n    ui.notifications.info(\n      game.i18n.format(\n        'WOD5E.Compendiums.Macros.RandomCharacterGenerator.Notifications.StringCreated',\n        {\n          string: newActor.name\n        }\n      )\n    )\n    newActor.sheet.render(true)\n  } catch (error) {\n    ui.notifications.error(\n      game.i18n.localize(\n        'WOD5E.Compendiums.Macros.RandomCharacterGenerator.Notifications.ErrorSettingValues'\n      )\n    )\n    console.error(\n      `World of Darkness 5e | ${game.i18n.localize(\n        'WOD5E.Compendiums.Macros.RandomCharacterGenerator.Notifications.UpdateError'\n      )}`,\n      error\n    )\n    console.log(\n      `World of Darkness 5e | ${game.i18n.localize(\n        'WOD5E.Compendiums.Macros.RandomCharacterGenerator.Notifications.AttemptedUpdateData'\n      )}`,\n      updateData\n    )\n  }\n}\n\ncreateRandomCharacter()","folder":null,"sort":0,"ownership":{"default":0,"0uQsagcnnkt56LRN":3},"flags":{},"_stats":{"compendiumSource":null,"duplicateSource":null,"exportSource":null,"coreVersion":"13.351","systemId":"wod5e","systemVersion":"5.3.4","createdTime":1763943507322,"modifiedTime":1763948593321,"lastModifiedBy":"0uQsagcnnkt56LRN"}}
{"name":"Adjust Hunger","type":"script","scope":"global","author":"OrOQ70SVPCGayvrw","img":"systems/wod5e/assets/icons/dice/vampire/success.png","command":"// Grab the list of selected tokens and map them\nconst tokens = canvas.tokens.controlled\nconst actorsList = tokens.map((i) => i.actor)\n\n// Build the options for the select dropdown\nconst content = new foundry.data.fields.NumberField({\n  label: game.i18n.localize('WOD5E.Compendiums.Macros.AdjustHungerBy'),\n  required: true,\n  nullable: false,\n  initial: 0,\n  min: -5,\n  max: 5\n}).toFormGroup(\n  {},\n  {\n    name: 'mod'\n  }\n).outerHTML\n\n// Prompt a dialog to determine which edge we're adding\nconst hungerModifier = await foundry.applications.api.DialogV2.prompt({\n  window: {\n    title: game.i18n.localize('WOD5E.Compendiums.Macros.AdjustHunger')\n  },\n  classes: ['wod5e', 'macro', 'dialog', 'vampire', 'dialog'],\n  content,\n  ok: {\n    callback: (event, button) =>\n      new foundry.applications.ux.FormDataExtended(button.form).object.mod\n  },\n  modal: true\n})\n\nif (hungerModifier) {\n  for (const actor of actorsList) {\n    // If the actor isn't a vampire or doesn't have hunger, skip them\n    if (actor.system.gamesystem !== 'vampire' && actor.system?.hunger) continue\n\n    // Grab the actor's current hunger\n    const oldValue = Number(actor.system.hunger.value)\n\n    // Add the hunger modifier to the actor's old vlaue\n    let newValue = oldValue + hungerModifier\n\n    // Check to make sure the input doesn't go over or below max/min values\n    if (newValue > 5) newValue = 5\n    if (newValue < 0) newValue = 0\n\n    actor.update({ 'system.hunger.value': newValue })\n  }\n}","folder":null,"ownership":{"default":0,"OrOQ70SVPCGayvrw":3},"flags":{"core":{}},"_stats":{"systemId":"vtm5e","systemVersion":"4.0.0-prerelease1","coreVersion":"13.351","createdTime":1701128684097,"modifiedTime":1764431146061,"lastModifiedBy":"0uQsagcnnkt56LRN","compendiumSource":null,"duplicateSource":null,"exportSource":null},"_id":"s3GbZTtgvLIpl4FP","sort":300000}
{"name":"Roll API Example","type":"script","scope":"global","author":"OrOQ70SVPCGayvrw","img":"icons/svg/dice-target.svg","command":"// This macro is an example of how you can access the WOD5E Roll API.\n\n// Define the actor\nconst actor = game.actors.get(ChatMessage.getSpeaker().actor)\n\n// Make sure we're only allowing vampires to roll this, since it includes hunger dice\nif (actor.type !== 'vampire') return ui.notifications.warn('Selected actor is not a vampire.')\n\n// Define any variables we need\nconst actorHunger = actor.system.hunger.value\nconst actorAttributes = actor.system.attributes\nconst actorDisciplines = actor.system.disciplines\n\n// Get the value of any bonuses\nconst strength = actorAttributes.strength.value\nconst animalism = actorDisciplines.animalism.value\n\n// Define hunger dice\nconst advancedDice = Math.max(actorHunger, 0)\n\n// Define vampire dice\n// \"Basic Dice\" is a calculation of what pool we're rolling, minus any \"Advanced Dice\"\nconst basicDice = Math.max((strength + animalism) - advancedDice, 0)\n\n// Send the roll to the API\nWOD5E.api.Roll({\ntitle: \"Custom Vampire Roll\",\nbasicDice,\nadvancedDice\n})","folder":null,"ownership":{"default":0,"OrOQ70SVPCGayvrw":3},"flags":{"core":{}},"_stats":{"systemId":"vtm5e","systemVersion":"4.0.0-prerelease2","coreVersion":"13.341","createdTime":1707614396503,"modifiedTime":1731184217275,"lastModifiedBy":"0uQsagcnnkt56LRN","compendiumSource":null,"duplicateSource":null,"exportSource":null},"_id":"xHe6LF89pUgEDxV3","sort":100000}
